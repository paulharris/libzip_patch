=== modified file 'libzip/regress/CMakeLists.txt'
--- libzip/regress/CMakeLists.txt	2012-01-09 03:18:36 +0000
+++ libzip/regress/CMakeLists.txt	2012-01-10 04:23:48 +0000
@@ -1,5 +1,11 @@
 ENABLE_TESTING()
 
+# getopt function is required for tryopen (a HELPER_TEST_PROGRAM)
+CHECK_FUNCTION_EXISTS(getopt HAVE_GETOPT)
+IF(NOT HAVE_GETOPT)
+  SET(SRC_EXTRA_FILES ../src/getopt.c)
+ENDIF(NOT HAVE_GETOPT)
+
 SET(STANDALONE_TEST_PROGRAMS
   add_from_buffer
   add_from_file
@@ -39,7 +45,7 @@
 ENDFOREACH(PROGRAM ${STANDALONE_TEST_PROGRAMS})
 
 FOREACH(PROGRAM ${HELPER_TEST_PROGRAMS})
-  ADD_EXECUTABLE(${PROGRAM} ${PROGRAM}.c)
+  ADD_EXECUTABLE(${PROGRAM} ${PROGRAM}.c ${SRC_EXTRA_FILES})
   TARGET_LINK_LIBRARIES(${PROGRAM} zip)
 ENDFOREACH(PROGRAM ${HELPER_TEST_PROGRAMS})
 

